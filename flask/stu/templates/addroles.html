{% extends 'base_main.html' %}
{% block extCSS %}
    <link href="/static/css/haiersoft.css" rel="stylesheet" type="text/css" media="screen,print"/>
    <link href="/static/css/print.css" rel="stylesheet" type="text/css" media="print"/>
{% endblock %}
{% block extJS %}
    <script src="/static/js/jquery-1.10.1.min.js"></script>
    <script src="/static/js/side.js" type="text/javascript"></script>

    <!--[if lt IE 9]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<![endif]-->
    <script type="text/javascript">
        $(function () {
            $(".select").each(function () {
                var s = $(this);
                var z = parseInt(s.css("z-index"));
                var dt = $(this).children("dt");
                var dd = $(this).children("dd");
                var _show = function () {
                    dd.slideDown(200);
                    dt.addClass("cur");
                    s.css("z-index", z + 1);
                };
                var _hide = function () {
                    dd.slideUp(200);
                    dt.removeClass("cur");
                    s.css("z-index", z);
                };
                dt.click(function () {
                    dd.is(":hidden") ? _show() : _hide();
                });
                dd.find("a").click(function () {
                    dt.html($(this).html());
                    _hide();
                });
                $("body").click(function (i) {
                    !$(i.target).parents(".select").first().is(s) ? _hide() : "";
                });
            })
        })
    </script>
{% endblock %}

{% block content %}
    <!-- Popup -->
    <div id="Popup">

        <!-- SubPopup -->
        <div id="SubPopup">

            <form action="" method="post">
                <div class="form_boxC">
                    <table cellpadding="0" cellspacing="0">
                        {% if u_id %}
                            <!--添加角色-->
                            <tr>
                                <th width="100">角色名称</th>
                                <td>
                                    <div class="selectbox" style="width:230px;">
                                        <select name="r_id" id="role">
                                            {% for role in roles %}
                                                <option value="{{ role.r_id }}">{{ role.r_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        {% else %}
                            <!-- 编辑 / 添加角色权限 -->
                            <tr>
                                <th width="100">用户名称</th>
                                <td>
                                    <div class="selectbox" style="width:230px;">
                                        {% if role %}
                                            <!-- 编辑角色权限 -->
                                            <input type="text" name="r_name" value="{{ role.r_name }}">
                                        {% else %}
                                            <!-- 添加角色权限 -->
                                            <input type="text" name="r_name" placeholder="请输入角色名">
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <th width="100">权限名称</th>
                                <td>
                                {% from 'common.html' import judge %}
                                {{ judge() }}
                                    <select multiple="multiple" name="p_name">

                                        {% for permission in permissions %}
                                            {% for r_p in role.permission %}
                                                {% if r_p.p_id == permission.p_id %}
                                                    <option value="{{ permission.p_id }}" selected>
                                                        {{ permission.p_name }}
                                                    </option>

                                                {% else %}
                                                    <option value="{{ permission.p_id }}">
                                                        {{ permission.p_name }}
                                                    </option>
                                                {% endif %}
                                            {% endfor %}
                                        {% endfor %}


                                    </select>

                                </td>
                            </tr>
                        {% endif %}
                    </table>
                    <div id="BtmBtn">
                        <div class="btn_box floatR">
                            <input name="" type="submit" value="提交">
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <!-- SubPopup -->


    </div>
    <!-- /Popup -->
{% endblock %}